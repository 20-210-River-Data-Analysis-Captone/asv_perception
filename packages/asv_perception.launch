<?xml version="1.0" encoding="utf-8"?>
<launch>

    <!-- platform-specific topic remaps; remap these values to your sensor outputs-->
    <arg name="imu_topic" default="/imu/data/enu" />
    <arg name="gps_topic" default="/sensor/fix/gps" />
    <arg name="radar0_topic" default="/broadband_radar/channel_0/segment" />
    <arg name="lidar0_topic" default="/velodyne_points" />

    <arg name="camera0_image_topic" default="/center_camera/image_color/compressed" />
    <arg name="camera0_calibration_file" default="$(env ASV_PERCEPTION_CONFIG)calib_camera0_homography.yaml" />
    <arg name="camera1_image_topic" default="/left_camera/image_color/compressed" />
    <arg name="camera1_calibration_file" default="$(env ASV_PERCEPTION_CONFIG)calib_camera1_homography.yaml" />
    <arg name="camera2_image_topic" default="/right_camera/image_color/compressed" />
    <arg name="camera2_calibration_file" default="$(env ASV_PERCEPTION_CONFIG)calib_camera2_homography.yaml" />

    <arg name="use_segmentation" default="$(optenv USE_SEGMENTATION 1)" />
    
    <!-- use_sim_time:  use when playing back bag files with rosbag play -->
    <group if="$(optenv USE_SIM_TIME 0)">
        <param name="/use_sim_time" value="true" />
    </group>
    
    <!-- localization:  launch the localization+tf stack -->
    <group if="$(optenv USE_LOCALIZATION 0)">
        <include file="$(env CATKIN_WS)/src/localization.launch" />
    </group>

    <!-- rgb-radar homography -->
    <include file="$(find asv_perception_homography)/launch/homography.launch">
        <arg name="imu_topic" value="$(arg imu_topic)" />
        <arg name="radar_topic" value="$(arg radar0_topic)" />
        <arg name="camera0_image_topic" default="$(arg camera0_image_topic)" />
        <arg name="camera0_calibration_file" default="$(arg camera0_calibration_file)" />
        <arg name="camera1_image_topic" default="$(arg camera1_image_topic)" />
        <arg name="camera1_calibration_file" default="$(arg camera1_calibration_file)" />
        <arg name="camera2_image_topic" default="$(arg camera2_image_topic)" />
        <arg name="camera2_calibration_file" default="$(arg camera2_calibration_file)" />
    </include>

    <!-- segmentation -->
    <group if="$(arg use_segmentation)">
        <include file="$(find asv_perception_segmentation)/launch/segmentation.launch">
            <arg name="camera0_image_topic" value="$(arg camera0_image_topic)" />
            <arg name="camera1_image_topic" value="$(arg camera1_image_topic)" />
            <arg name="camera2_image_topic" value="$(arg camera2_image_topic)" />
        </include>
    </group>

    <!-- classification -->
    <include file="$(find asv_perception_classification)/launch/classification.launch">
        <arg name="camera0_image_topic" value="$(arg camera0_image_topic)" />
        <arg name="camera1_image_topic" value="$(arg camera1_image_topic)" />
        <arg name="camera2_image_topic" value="$(arg camera2_image_topic)" />
    </include>

    <!-- obstacle generation -->
    <include file="$(find asv_perception_obstacleid)/launch/obstacleid.launch">
        <arg name="use_segmentation" value="$(arg use_segmentation)" />
        <arg name="radar0_topic" value="$(arg radar0_topic)" />
        <arg name="lidar0_topic" value="$(arg lidar0_topic)" />
    </include>

    <!-- obstacle tracking -->
    <include file="$(find asv_perception_tracking)/launch/tracking.launch" />

</launch> 